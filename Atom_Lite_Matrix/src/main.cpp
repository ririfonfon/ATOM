#include "M5Atom.h"
const unsigned char cMatrix[13][77] = {

    {/* Line   000 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, // 1
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00},// 

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 2
     /* Line   003 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},// 

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 3
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},// 

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 4
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 5
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 6
     /* Line   003 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},// 

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 7
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 8
     /* Line   003 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 9
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 0
     /* Line   003 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // .
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0xff,0xff,0xff, 0x00,0x00,0x00, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0xff,0xff,0xff, 0xff,0xff,0xff, 0xff,0xff,0xff, 0x00,0x00,0x00, // -
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00},//

    {/* Line   000 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   001 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   002 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // space
     /* Line   003 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, // 
     /* Line   004 */ 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0x00,0x00} // 

};

const String cChars = "1234567890.- ";
const int charW = 5;
const int charH = 5;
const int colors = 3;
bool IMU6886Flag = false;
void setup()
{
    M5.begin(true, false, true);
    delay(50);
    String myMsg = "192.168.000.001 ";
    //192.168.0.1
    int msgLen = myMsg.length();
    int screenW = msgLen * charW;

    int arraySize = msgLen * ((colors * charW * charH) + msgLen) ;
    Serial.println("Array size=" + String(arraySize));
    unsigned char aData[arraySize]; // 3 colors, 4 pixels, 5 rows
    aData[0] = screenW;
    aData[1] = charH;

    for (int line = 0; line < 5; line++)
    {
        int lOffset = (line * msgLen) * colors * charW; // 3 colors, 4 pixels wide

        for (int i = 0; i < myMsg.length(); i++)
        {
            int i2 = cChars.indexOf(myMsg.charAt(i)); // Offset in cMatrix[i2]
            i2 = (i2 == -1) ? 12 : i2;                // Space for unknown chars

            //   Serial.println("Char:" + String(myMsg.charAt(i)) + " loffset=" + String(lOffset) + " line=" + String(line) + " i2=" + String(i2));

            for (int p = 0; p < charW * colors; p++)
            {
                int p2 = (i * charW * colors) + p; // Position in target array
                int px = cMatrix[i2][p + (line * colors * charW)];

                //   Serial.println("We will set aData[" + String(p2+lOffset+2) + "] to cMatrix[" + String(i2) + "][" + String(p+(line*colors*charW)) + "] = " + String(px));
                // aData[p2 + lOffset + 2] = px;
                aData[p2 + lOffset + 5] = px;
            }
        }
    }

    M5.dis.animation((uint8_t *)aData, 500, LED_Display::kMoveLeft, screenW - 5);
}
void loop()
{
    delay(500);
    M5.update();
}
